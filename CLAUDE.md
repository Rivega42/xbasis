# CLAUDE.md — Инструкции для работы с ShipKit

> Этот файл читается ПЕРВЫМ в начале каждой сессии

---

## 🚀 Быстрый старт сессии

### 1. Прочитай документацию (ОБЯЗАТЕЛЬНО)

```
ВСЕГДА читай в начале сессии:
├── docs/CONTEXT.md      # Что за проект, стек, архитектура
├── docs/FEATURES.md     # Что готово, что делать (первые 100 строк)
└── docs/SESSION.md      # Последняя сессия, текущие TODO
```

### 2. Читай по необходимости

```
При вопросах "почему так?":
└── docs/DECISIONS.md    # История решений

При багах или странном поведении:
└── docs/PROBLEMS.md     # Известные проблемы

При работе с API:
└── docs/API.md          # Endpoints документация

При релизе:
└── CHANGELOG.md         # История версий
```

---

## 📁 Структура проекта

```
xbasis/
├── CLAUDE.md              ← ТЫ ЗДЕСЬ (читай первым!)
├── docs/
│   ├── CONTEXT.md         # Ядро: что, зачем, как
│   ├── FEATURES.md        # Реестр всех функций
│   ├── SESSION.md         # Текущая сессия
│   ├── DECISIONS.md       # Архитектурные решения
│   ├── PROBLEMS.md        # Известные проблемы
│   └── API.md             # API документация
├── src/
│   └── api/               # FastAPI backend
├── web/                   # Next.js frontend
└── CHANGELOG.md           # История версий
```

---

## 📋 Правила работы с документацией

### CONTEXT.md
| Когда читать | Когда обновлять |
|--------------|-----------------|
| В начале КАЖДОЙ сессии | При изменении стека/архитектуры |
| При вопросах о проекте | При добавлении нового компонента |

### FEATURES.md
| Когда читать | Когда обновлять |
|--------------|-----------------|
| В начале сессии | После завершения функции |
| При планировании | При начале работы над функцией |

**Статусы:**
- 🔲 Planned — не начато
- 🔄 In Progress — в работе
- ✅ Done — готово
- ❌ Blocked — заблокировано

### SESSION.md
| Когда читать | Когда обновлять |
|--------------|-----------------|
| В начале сессии | В КОНЦЕ каждой сессии |

### DECISIONS.md
| Когда читать | Когда обновлять |
|--------------|-----------------|
| При вопросах "почему X?" | При ЛЮБОМ архитектурном решении |

### PROBLEMS.md
| Когда читать | Когда обновлять |
|--------------|-----------------|
| При багах | При обнаружении/решении проблемы |

---

## 🔄 Чеклист конца сессии

```
Перед завершением сессии ОБЯЗАТЕЛЬНО:

□ Обновить FEATURES.md (статусы функций)
□ Обновить SESSION.md (что сделано + TODO)
□ Если были решения → добавить в DECISIONS.md
□ Если нашли баги → добавить в PROBLEMS.md
□ Закоммитить изменения docs/
```

---

## 🎨 Стек и конвенции

### Backend (Python/FastAPI)
- **Style:** Black + Ruff
- **Types:** Полная типизация (Pydantic, SQLAlchemy)
- **Async:** Везде async/await
- **Naming:** snake_case

### Frontend (Next.js)
- **Style:** Prettier + ESLint
- **Components:** shadcn/ui
- **Styling:** Tailwind CSS
- **Naming:** PascalCase для компонентов, camelCase для функций

### Git
- **Commits:** `feat:`, `fix:`, `docs:`, `refactor:`
- **Branches:** `feature/xxx`, `fix/xxx`

---

## ⚡ Частые команды

```bash
# Backend
docker-compose up -d          # Запуск
docker-compose logs -f api    # Логи
pytest                        # Тесты

# API Docs
open http://localhost:8000/docs

# Frontend
cd web
npm run dev
```

---

## 🎭 Режим работы: Архитектор → Агенты

### Принцип работы

```
┌──────────────────────────────────────────────────────────────────┐
│                         АРХИТЕКТОР                                │
│  1. Анализ проекта и задач                                       │
│  2. Определение нужных ролей                                     │
│  3. Распределение задач (параллельно где можно)                  │
│  4. Приёмка работы                                               │
└─────────────────────────────┬────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
   ┌─────────┐          ┌─────────┐          ┌─────────┐
   │ @backend│          │@frontend│          │  @docs  │
   └────┬────┘          └────┬────┘          └────┬────┘
        │    ПАРАЛЛЕЛЬНО     │                    │
        └────────────────────┴────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│                         АРХИТЕКТОР                                │
│              Сборка результатов, проверка, приёмка               │
└──────────────────────────────────────────────────────────────────┘
```

### Роли агентов

| Роль | Когда нанимать |
|------|----------------|
| @backend | API, бизнес-логика, БД |
| @frontend | UI, компоненты, стили |
| @architect | Сложные решения, выбор стека |
| @reviewer | Code review, рефакторинг |
| @docs | Документация, README |
| @devops | CI/CD, деплой, Docker |
| @qa | Тесты, edge cases |

### Правила параллелизации

```
✅ МОЖНО параллельно:
- Backend API + Документация
- Разные страницы frontend  
- Тесты + Основной код

❌ НЕЛЬЗЯ параллельно:
- Frontend зависит от API (сначала API)
- Компонент B использует A (сначала A)
```

---

## 🚫 Не делай

- Не меняй стек без обновления CONTEXT.md
- Не добавляй функции без записи в FEATURES.md
- Не принимай решения без записи в DECISIONS.md
- Не заканчивай сессию без обновления SESSION.md
- **Не начинай кодить без плана и подтверждения**
- **Не пропускай фазу приёмки**
